/*
 * jQuery Mobile Framework : plugin to provide a simple popup (modal) or jQMdialog (page) Dialog widget.
 * Copyright (c) JTSage
 * CC 3.0 Attribution.  May be relicensed without permission/notifcation.
 * https://github.com/jtsage/jquery-mobile-simpledialog
 */

(function(a,b){a.widget("mobile.simpledialog",a.mobile.widget,{options:{pickPageTheme:"b",pickPageInputTheme:"e",pickPageButtonTheme:"a",disabled:false,zindex:"500",width:"280px",prompt:"Are you sure?",mode:"bool",allowReopen:true,useModal:true,forceInput:true,isOpen:false,blankMode:false,fullHTML:null,subTitle:false,inputPassword:false,cleanOnClose:false,animate:true,transition:"pop",left:b,top:b,useDialogForceTrue:false,useDialogForceFalse:false,useDialog:false,isInit:false,sawOnce:false,enterToTrigger:0,escToTrigger:1,butObj:[],debug:false},_eventHandler:function(c,e){var d=a(this).data("simpledialog"),f=d.options;if(!c.isPropagationStopped()){switch(e.method){case"close":d.close(e.fromCloseButton);break;case"open":d.open();break;case"refresh":d.refresh();break;case"button":f.butObj[e.index].trigger("click");break}}},_orientChange:function(d){var c=a(d.currentTarget).data("simpledialog");o=c.options,docWinWidth=a(document).width(),docWinHeightOffset=a(window).scrollTop(),docWinHeight=a(window).height(),pickWinHeight=c.pickerContent.outerHeight(),pickWinWidth=c.pickerContent.innerWidth(),pickWinTop=(parseFloat(o.top)+10000)?parseFloat(o.top):(docWinHeightOffset+(docWinHeight/2)-(pickWinHeight/2)),pickWinLeft=(parseFloat(o.left)+10000)?parseFloat(o.left):((docWinWidth/2)-(pickWinWidth/2));if((pickWinHeight+pickWinTop)>a(document).height()){pickWinTop=a(document).height()-(pickWinHeight+2)}if(pickWinTop<45){pickWinTop=45}d.stopPropagation();if(!c.pickerContent.is(":visible")||o.useDialog===true){return false}else{c.pickerContent.css({top:pickWinTop,left:pickWinLeft})}},open:function(){if(this.pickPage.is(":visible")){return false}var j=this,c=this.options,d=a(document).width(),e=a(window).scrollTop(),g=a(window).height(),k=j.pickerContent.outerHeight(),h=j.pickerContent.innerWidth(),f=(parseFloat(c.top)+10000)?parseFloat(c.top):(e+(g/2)-(k/2)),i=(parseFloat(c.left)+10000)?parseFloat(c.left):((d/2)-(h/2));if((k+f)>a(document).height()){f=a(document).height()-(k+2)}if(f<45){f=45}if(c.prompt!==false){j.pickerHeader.html(c.prompt);j.pickPage.find(".ui-header").find(".ui-title").text(c.prompt)}j.pickerContent.find(".ui-btn-active").removeClass("ui-btn-active");if(!c.disabled){if((d>400&&!c.useDialogForceTrue)||c.useDialogForceFalse){c.useDialog=false;if(c.useModal){if(c.animate===true){j.screen.fadeIn("slow")}else{j.screen.show()}}else{j.screen.removeClass("ui-simpledialog-hidden")}j.pickerContent.addClass("ui-overlay-shadow").css("zIndex",j.options.zindex);j.pickerHeader.show();j.pickerContent.css({position:"absolute",top:f,left:i}).addClass("ui-overlay-shadow in").removeClass("ui-simpledialog-hidden")}else{j.thisPage.unbind("pagehide.remove");c.useDialog=true;j.pickPageContent.append(j.pickerContent);j.pickerHeader.hide();j.pickerContent.removeClass("ui-overlay-shadow ui-simpledialog-hidden").css({top:"auto",left:"auto",marginLeft:"auto",marginRight:"auto"}).css("zIndex",j.options.zindex);a.mobile.changePage(j.pickPage,{transition:(c.animate===true)?c.transition:"none"})}this.options.isOpen=true}},close:function(c){var d=this,c=(typeof(c)==="undefined")?false:c;if(d.options.useDialog){if(c===false){a(d.pickPage).dialog("close")}if(!d.thisPage.data("page").options.domCache){d.thisPage.bind("pagehide.remove",function(){a(d).remove()})}d.pickerContent.addClass("ui-simpledialog-hidden");d.thisPage.append(d.pickerContent)}else{if(d.options.useModal){if(d.options.animate===true){d.screen.fadeOut("slow")}else{d.screen.hide()}}else{d.screen.addClass("ui-simpledialog-hidden")}d.pickerContent.addClass("ui-simpledialog-hidden").removeClass("in")}d.caller.removeClass("ui-btn-active");d.options.isOpen=false;if(d.options.cleanOnClose===true&&d.options.useDialog===false){d.clean()}},clean:function(){var c=this;c.pickerContent.remove();c.pickPage.remove();c.screen.remove();c.caller.removeData("simpledialog")},_create:function(){var d=this,i=a.extend(this.options,this.element.data("options")),e=this.element;if(i.isInit&&i.allowReopen){d.open()}else{var h=e.closest(".ui-page"),c=a("<div data-role='dialog' class='ui-simpledialog-dialog' data-theme='"+i.pickPageTheme+"' ><div data-role='header' data-backbtn='false' data-theme='a'><div class='ui-title'>"+i.prompt+"</div></div><div data-role='content'></div></div>"),g=null,f=null;if(i.mode==="blank"){g=a("<div class='ui-simpledialog-container ui-overlay-shadow ui-corner-all ui-simpledialog-hidden "+((i.animate===true)?i.transition:"")+" ui-body-"+i.pickPageTheme+"'></div>");g.html(i.fullHTML);a("[data-role=content]",c).append(g)}c.appendTo(a.mobile.pageContainer).page().css("minHeight","0px").css("zIndex",i.zindex);if(i.animate===true){c.addClass("pop")}f=c.find(".ui-content");e.live("simpledialog",d._eventHandler);c.find(".ui-header a").bind("vclick",function(j){j.preventDefault();j.stopImmediatePropagation();d.close(true)});if(i.prompt===false){c.find(".ui-header").find(".ui-title").html("&nbsp;")}a.extend(d,{pickPage:c,thisPage:h,pickPageContent:f,screen:screen,caller:e});d._buildPage();d.options.isInit=true;a(document).bind("orientationchange",function(j){e.trigger("orientationchange")});e.bind("orientationchange",d._orientChange)}},_reposition:function(){var j=this,c=this.options,d=a(document).width(),e=a(window).scrollTop(),g=a(window).height(),k=j.pickerContent.outerHeight(),h=j.pickerContent.innerWidth(),f=(parseFloat(c.top)+10000)?parseFloat(c.top):(e+(g/2)-(k/2)),i=(parseFloat(c.left)+10000)?parseFloat(c.left):((d/2)-(h/2));if((k+f)>a(document).height()){f=a(document).height()-(k+2)}if(f<45){f=45}j.pickerContent.css({position:"absolute",top:f,left:i})},refresh:function(){if(!this.options.mode==="blank"){return false}else{this.pickerContent.html(this.options.fullHTML);this.pickerContent.trigger("create");if(this.pickerContent.is(":visible")&&this.options.useDialog===false){this._reposition()}}},_init:function(){if(!this.options.sawOnce||this.options.allowReopen){this.options.sawOnce=true;this.open()}},_buildPage:function(){var e=this,g=e.options,f,d,c,i=a("<div>",{"class":"ui-simpledialog-container ui-overlay-shadow ui-corner-all ui-simpledialog-hidden "+((g.animate===true)?g.transition:"")+" ui-body-"+g.pickPageTheme}).css({zIndex:g.zindex,width:g.width}),h=a("<div class='ui-simpledialog-header'><h4></h4></div>").appendTo(i).find("h4");if(g.mode!=="blank"){if(g.prompt!==false){h.html(g.prompt)}else{h.parent().html()}if(g.subTitle!==false){a("<p class='ui-simpledialog-subtitle'>"+g.subTitle+"<p>").appendTo(i)}if(g.mode==="string"){f=a("<div class='ui-simpledialog-controls'><input class='ui-simpledialog-input ui-input-text ui-shadow-inset ui-corner-all ui-body-"+g.pickPageInputTheme+"' type='"+((g.inputPassword===true)?"password":"text")+"' name='pickin' /></div>").bind("keyup",function(j){if(j.keyCode===13&&g.enterToTrigger!==false){g.butObj[g.enterToTrigger].trigger("click")}if(j.keyCode===27&&g.escToTrigger!==false){g.butObj[g.escToTrigger].trigger("click")}}).appendTo(i)}d=a("<div>",{"class":"ui-simpledialog-controls"}).appendTo(i);a.each(g.buttons,function(j,k){k=a.isFunction(k)?{click:k}:k;k=a.extend({text:j,theme:g.pickPageButtonTheme,icon:"check",iconpos:"left",closeOnClick:true},k);g.butObj.push(a("<a href='#'>"+j+"</a>").appendTo(d).buttonMarkup({theme:k.theme,icon:k.icon,iconpos:k.iconpos,corners:true,shadow:true}).unbind("vclick").unbind("click").bind("click",function(){if(g.mode==="string"){e.caller.attr("data-string",f.find("input").val())}var l=k.click.apply(e.element[0],arguments);if(l!==false&&k.closeOnClick===true){e.close()}}))})}else{i=e.pickPageContent.contents()}i.appendTo(e.thisPage);c=a("<div>",{"class":"ui-simpledialog-screen ui-simpledialog-hidden"}).css({"z-index":g.zindex-1}).appendTo(e.thisPage).bind("click",function(j){if(!g.forceInput){e.close()}j.preventDefault()});if(g.useModal){c.addClass("ui-simpledialog-screen-modal")}a.extend(e,{pickerContent:i,pickerHeader:h,screen:c})},disable:function(){this.options.disabled=true},enable:function(){this.options.disabled=false}})})(jQuery);